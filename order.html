<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CVK ENTERPRISE - Order</title>
</head>
<body>

<h2>Online Order</h2>

<!-- Customer Details -->
<label>Customer Name:</label><br>
<input type="text" id="custName"><br><br>

<label>Mobile Number:</label><br>
<input type="text" id="custMobile"><br><br>

<label>Message:</label><br>
<textarea id="custMessage"></textarea><br><br>

<hr>

<h3>Add Products</h3>

<input type="text" id="productName" placeholder="Product Name">
<input type="number" id="productQty" placeholder="Qty" value="1">
<button type="button" onclick="addProduct()">‚ûï Add Product</button>

<h3>Products List</h3>
<table border="1" width="100%">
  <thead>
    <tr>
      <th>#</th>
      <th>Product</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody id="productList">
  </tbody>
</table>

<br>
<button type="button" onclick="submitOrder()">‚úÖ Submit Order</button>

<script>
const ORDER_API = "https://script.google.com/macros/s/AKfycbyAvqWNIyBJDKK6E1K51QlOKddsVyaznfJp7MbE7loD2w5XnaNOtJSY6vAmneMRwjEW/exec";

let products = [];

/* ADD PRODUCT FUNCTION */
function addProduct() {
  const name = document.getElementById("productName").value.trim();
  const qty = document.getElementById("productQty").value;

  if (name === "" || qty === "") {
    alert("Product name & quantity ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø");
    return;
  }

  products.push({ product: name, quantity: qty });

  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${products.length}</td>
    <td>${name}</td>
    <td>${qty}</td>
  `;
  document.getElementById("productList").appendChild(row);

  document.getElementById("productName").value = "";
  document.getElementById("productQty").value = 1;
}

/* SUBMIT ORDER FUNCTION */
function submitOrder() {
  if (products.length === 0) {
    alert("‡∞ï‡∞®‡±Ä‡∞∏‡∞Ç ‡∞í‡∞ï ‡∞™‡±ç‡∞∞‡±ä‡∞°‡∞ï‡±ç‡∞ü‡±ç add ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø");
    return;
  }

  const data = {
    name: document.getElementById("custName").value,
    mobile: document.getElementById("custMobile").value,
    message: document.getElementById("custMessage").value,
    products: products
  };

  fetch(ORDER_API, {
    method: "POST",
    headers: {
      "Content-Type": "text/plain;charset=UTF-8"
    },
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(() => {
    alert("Order successfully submitted üéâ");
    products = [];
    document.getElementById("productList").innerHTML = "";
  })
  .catch(err => {
    alert("Error occurred");
    console.log(err);
  });
}
</script>

</body>
</html>
